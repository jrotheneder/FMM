(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     15622,        391]
NotebookOptionsPosition[     14041,        355]
NotebookOutlinePosition[     14695,        377]
CellTagsIndexPosition[     14652,        374]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["FMM Seq. Test & Quadtree Visualization", "Title",
 CellChangeTimes->{{3.765306072713745*^9, 3.7653060835077667`*^9}},
 TextAlignment->Center,ExpressionUUID->"20b3e9fa-13ef-437a-8ffb-39c21866f0df"],

Cell[BoxData[{
 RowBox[{"<<", " ", "Utility`"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"<<", " ", "MaTeX`"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "[", "NBD", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.765306193441283*^9, 3.7653062037009497`*^9}, {
   3.765312056691987*^9, 3.765312056873152*^9}, 3.765314656681868*^9},
 CellLabel->"In[1]:=",ExpressionUUID->"a297ad90-e482-4d8d-ac2f-afc759f162cc"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Range", "[", "5", "]"}], "[", 
  RowBox[{"[", 
   RowBox[{"2", ";;", 
    RowBox[{"2", "+", "1"}]}], "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Range", "[", "5", "]"}], "[", 
  RowBox[{"[", 
   RowBox[{"3", ";;", "5"}], "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.765560649398834*^9, 3.765560677004524*^9}},
 CellLabel->"In[94]:=",ExpressionUUID->"01e50b4b-9891-441b-8f51-e6043b47cfe4"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"2", ",", "3"}], "}"}]], "Output",
 CellChangeTimes->{{3.765560650880862*^9, 3.765560677373013*^9}},
 CellLabel->"Out[94]=",ExpressionUUID->"0d41f0ba-d3f5-43ed-becc-7ea6477a715d"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"3", ",", "4", ",", "5"}], "}"}]], "Output",
 CellChangeTimes->{{3.765560650880862*^9, 3.765560677375049*^9}},
 CellLabel->"Out[95]=",ExpressionUUID->"dbeab4f9-97d3-4788-a70c-cdbaf4041e09"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"treeGeometryData", " ", "=", " ", 
   RowBox[{"Import", "[", 
    RowBox[{"\"\<geometry.dat\>\"", ",", "\"\<Table\>\"", ",", 
     RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<,\>\""}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dim", " ", "=", " ", 
    RowBox[{
     RowBox[{"1", "/", "2"}], " ", 
     RowBox[{"Length", " ", "@", " ", 
      RowBox[{"treeGeometryData", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", 
         RowBox[{"3", ";;"}]}], "]"}], "]"}]}]}]}], ";"}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"quadtreeNodes", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"center", " ", "=", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"3", ";;", 
             RowBox[{"3", "+", "dim", "-", "1"}]}], "]"}], "]"}]}], ",", 
         RowBox[{"lwr\[LetterSpace]left", " ", "=", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"3", "+", "dim"}], ";;"}], "]"}], "]"}]}]}], "}"}], ",", 
       
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
         "lwr\[LetterSpace]left", ",", " ", 
         RowBox[{
          RowBox[{"2", " ", "center"}], " ", "-", "lwr\[LetterSpace]left"}]}],
         " ", "]"}]}], "]"}], "&"}], "/@", " ", "treeGeometryData"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"quadtreeData", " ", "=", " ", 
    RowBox[{"Import", "[", 
     RowBox[{"\"\<points.dat\>\"", ",", "\"\<Table\>\"", ",", 
      RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<,\>\""}]}], "]"}]}], 
   ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"height", " ", "=", " ", 
    RowBox[{"Max", " ", "@", " ", 
     RowBox[{"quadtreeNodes", "[", 
      RowBox[{"[", 
       RowBox[{";;", ",", "2"}], "]"}], "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"quadtreeNodesbyLevel", " ", "=", " ", 
   RowBox[{"GroupBy", "[", 
    RowBox[{"quadtreeNodes", ",", 
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "&"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"quadtreeDataByNode", " ", "=", " ", 
   RowBox[{
    RowBox[{"Association", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"2", ";;"}], "]"}], "]"}], ",", "dim"}], "]"}]}], "&"}], "/@",
       " ", "quadtreeData"}], "]"}], " ", "//.", " ", 
    RowBox[{
     RowBox[{"{", "}"}], "\[Rule]", 
     RowBox[{"Sequence", "[", "]"}]}]}]}], " ", ";"}]}], "Input",
 CellChangeTimes->{{3.765306153826641*^9, 3.765306156166518*^9}, {
   3.765306189916923*^9, 3.765306192420001*^9}, {3.765306228443913*^9, 
   3.7653062365296507`*^9}, {3.765310359930539*^9, 3.765310373248488*^9}, {
   3.76531056810246*^9, 3.765310588148979*^9}, {3.765310654651972*^9, 
   3.765310666178987*^9}, {3.76531072093867*^9, 3.765310723858541*^9}, 
   3.7653128064957952`*^9, {3.7653146454122467`*^9, 3.765314659642091*^9}, 
   3.765465209130671*^9, {3.765548501441495*^9, 3.765548508314419*^9}, {
   3.765548588366755*^9, 3.7655485913270483`*^9}, 3.76554954508352*^9, {
   3.765560196170577*^9, 3.765560199703437*^9}, {3.765560351007453*^9, 
   3.765560403451131*^9}, {3.7655605232748213`*^9, 3.765560574863751*^9}, {
   3.765560612183036*^9, 3.765560647398563*^9}, {3.765560686453608*^9, 
   3.7655607024246197`*^9}, {3.7655607864084473`*^9, 3.765560788979247*^9}, {
   3.765560846973298*^9, 3.765560847835854*^9}, {3.765560919266876*^9, 
   3.765561004424477*^9}, {3.7655617295629168`*^9, 3.765561732264578*^9}, {
   3.7655623289450293`*^9, 3.765562333948988*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"ead56676-13ad-4377-a2bc-d4bc6a788c08"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"lpPoints", " ", "=", " ", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"dim", " ", "\[Equal]", " ", "2"}], ",", " ", 
     RowBox[{"ListPlot", "[", 
      RowBox[{
       RowBox[{"Values", "[", "quadtreeDataByNode", "]"}], ",", 
       RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"ListPointPlot3D", "[", 
      RowBox[{
       RowBox[{"Values", "[", "quadtreeDataByNode", "]"}], ",", 
       RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"graphicsFun", "[", "l_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"dim", " ", "\[Equal]", " ", "2"}], ",", " ", 
     RowBox[{"Graphics", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"EdgeForm", "[", "Black", "]"}], ",", 
         RowBox[{"Opacity", "[", "0", "]"}], ",", 
         RowBox[{"Dynamic", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Rectangle", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"3", ";;", 
                 RowBox[{"3", "+", "dim", "-", "1"}]}], "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"3", "+", "dim"}], ";;"}], "]"}], "]"}]}], "]"}], 
            "&"}], "/@", " ", 
           RowBox[{"quadtreeNodesbyLevel", "[", "l", "]"}]}], "]"}]}], "}"}], 
       ",", 
       RowBox[{"Frame", "\[Rule]", "True"}]}], "]"}], ",", " ", 
     RowBox[{"Graphics3D", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"EdgeForm", "[", "Black", "]"}], ",", 
        RowBox[{"Opacity", "[", "0", "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Dynamic", "[", 
           RowBox[{"Cuboid", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"3", ";;", 
                RowBox[{"3", "+", "dim", "-", "1"}]}], "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"3", "+", "dim"}], ";;"}], "]"}], "]"}]}], "]"}], 
           "]"}], "&"}], "/@", " ", 
         RowBox[{"quadtreeNodesbyLevel", "[", "l", "]"}]}]}], "}"}], "]"}]}], 
    "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"Show", 
    StyleBox["[", "Input"], 
    StyleBox[
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"lpPoints", ",", "\[IndentingNewLine]", 
       RowBox[{"graphicsFun", "[", "l", "]"}]}], "\[IndentingNewLine]", "}"}],
      "Input"], 
    StyleBox["]", "Input"]}], ",", 
   RowBox[{"{", 
    RowBox[{"l", ",", "0", ",", "height", ",", "1"}], "}"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQBmIQfehW0LrDvG8c/zgVHQTRp/w87oHo6OneYHrla4dH
YPG2HY9B9GvXx8pHgLQRA48qiJ6nMjUGROf2zwTTP0T5k0E03zRhMH3roRcr
H98bx2P/NnOC6Cmeb9RBtAzfF10QLXJqoYsZkE5oWAym22MveIDoosyrYHrC
AetIEF2gmQymT9w3TQTRIUHmYPrZjYtdIJoh9BqYLor542kOohOyvUD0mTmN
SSD6jvBMMO0kJLYJRN+wSQHTjxiXfwPLTzwOpnes/allAaT3nV6tC6InvMhw
AvOLG8C0sdMmNxAdkJvnDqLP/IzwBdFaczr8QLTNwR/vbYC02o0d/0D07apP
TLZA+kjwOmYQ/Ub1lyCIll8rIwSiWR6oSoPoY7W7FEC0BZuGIYi+t8DVHETb
nJ5eC6IbJj0B0wBHX8Bi
  "],
 CellLabel->"In[31]:=",ExpressionUUID->"d3a5136f-f884-468d-a6ea-0fda3d884643"],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`l$$ = 2, Typeset`show$$ = True, 
    Typeset`bookmarkList$$ = {}, Typeset`bookmarkMode$$ = "Menu", 
    Typeset`animator$$, Typeset`animvar$$ = 1, Typeset`name$$ = 
    "\"untitled\"", Typeset`specs$$ = {{
      Hold[$CellContext`l$$], 0, 2, 1}}, Typeset`size$$ = {
    1032., {505., 512.}}, Typeset`update$$ = 0, Typeset`initDone$$, 
    Typeset`skipInitDone$$ = True, $CellContext`l$6521$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, "Variables" :> {$CellContext`l$$ = 0}, 
      "ControllerVariables" :> {
        Hold[$CellContext`l$$, $CellContext`l$6521$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> Show[{$CellContext`lpPoints, 
         $CellContext`graphicsFun[$CellContext`l$$]}], 
      "Specifications" :> {{$CellContext`l$$, 0, 2, 1}}, "Options" :> {}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{1079., {550., 557.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.765312911092852*^9, 3.765313036023178*^9}, 
   3.765313266627288*^9, 3.7653138328675413`*^9, 3.765314127652234*^9, 
   3.765314215037654*^9, 3.7653142773467417`*^9, 3.7653143289895906`*^9, 
   3.76531445141324*^9, {3.7653146615149097`*^9, 3.7653146699703913`*^9}, {
   3.765361557661113*^9, 3.7653615753215218`*^9}, {3.7654651085084047`*^9, 
   3.765465166340571*^9}, {3.765465398818254*^9, 3.7654654156189213`*^9}, 
   3.765465456150857*^9, {3.7654864620707407`*^9, 3.765486467329773*^9}, {
   3.765547258287045*^9, 3.7655472640776443`*^9}, {3.765547505090053*^9, 
   3.765547591612275*^9}, {3.765547724103897*^9, 3.765547734203333*^9}, {
   3.76554778656467*^9, 3.765547810608712*^9}, 3.765548076732621*^9, 
   3.7655481195036182`*^9, 3.765548301244248*^9, 3.7655487697494993`*^9, 
   3.765548876254799*^9, 3.76554956385641*^9, 3.765549652059251*^9, 
   3.765549845393401*^9, 3.765550483880498*^9, 3.765550657098749*^9, 
   3.76555086621697*^9, 3.7655510307844887`*^9, 3.765551471053134*^9, 
   3.7655516761489897`*^9, {3.7655517330808687`*^9, 3.765551745641128*^9}, {
   3.7655543890548277`*^9, 3.7655544067150784`*^9}, 3.765561289566967*^9, 
   3.765561335588121*^9, 3.765561373825232*^9, {3.765561580100933*^9, 
   3.765561606264292*^9}, 3.7655616460335827`*^9, {3.7655617425220633`*^9, 
   3.765561786838826*^9}, 3.76556183889212*^9, {3.765562338962289*^9, 
   3.7655623554353848`*^9}, {3.765562404090213*^9, 3.765562414607958*^9}, 
   3.765562462464918*^9},
 CellLabel->"Out[33]=",ExpressionUUID->"35a153d7-1913-4262-af97-228908a0456e"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"n", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", " ", "@", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{"#", ",", "1"}], "]"}]}], "&"}], "@", " ", 
    RowBox[{"Values", "[", "quadtreeDataByNode", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nLeaves", " ", "=", " ", 
   RowBox[{"Length", " ", "@", " ", "quadtreeData"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"avgNPerLeaf", " ", "=", " ", 
   RowBox[{
    RowBox[{"n", "/", "nLeaves"}], " ", "//", "N"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.765551787041687*^9, 3.765551890652936*^9}, {
  3.765561623404464*^9, 3.765561627787978*^9}, {3.765561724289393*^9, 
  3.7655617257193613`*^9}},
 CellLabel->
  "In[245]:=",ExpressionUUID->"5f4d786d-ae84-42f8-86f5-3a6c133fd78b"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7655518404252777`*^9, 
  3.7655518575659533`*^9}},ExpressionUUID->"a6b2643c-fbfd-444a-96da-\
c903e107fe5e"]
}, Open  ]]
},
WindowSize->{1920, 1025},
WindowMargins->{{0, Automatic}, {0, Automatic}},
FrontEndVersion->"12.0 for Linux x86 (64-bit) (April 8, 2019)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"]], 
   Cell[
    StyleData["Graphics", All], FontFamily -> "CMU Serif", FontSize -> 10, 
    FontColor -> GrayLevel[0]]}, Visible -> False, FrontEndVersion -> 
  "12.0 for Linux x86 (64-bit) (April 8, 2019)", StyleDefinitions -> 
  "PrivateStylesheetFormatting.nb"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 202, 2, 99, "Title",ExpressionUUID->"20b3e9fa-13ef-437a-8ffb-39c21866f0df"],
Cell[785, 26, 485, 10, 117, "Input",ExpressionUUID->"a297ad90-e482-4d8d-ac2f-afc759f162cc",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1295, 40, 441, 11, 55, "Input",ExpressionUUID->"01e50b4b-9891-441b-8f51-e6043b47cfe4"],
Cell[1739, 53, 218, 4, 35, "Output",ExpressionUUID->"0d41f0ba-d3f5-43ed-becc-7ea6477a715d"],
Cell[1960, 59, 228, 4, 35, "Output",ExpressionUUID->"dbeab4f9-97d3-4788-a70c-cdbaf4041e09"]
}, Open  ]],
Cell[2203, 66, 4215, 106, 216, "Input",ExpressionUUID->"ead56676-13ad-4377-a2bc-d4bc6a788c08"],
Cell[CellGroupData[{
Cell[6443, 176, 3440, 90, 239, "Input",ExpressionUUID->"d3a5136f-f884-468d-a6ea-0fda3d884643"],
Cell[9886, 268, 3140, 54, 1126, "Output",ExpressionUUID->"35a153d7-1913-4262-af97-228908a0456e"]
}, Open  ]],
Cell[13041, 325, 825, 22, 78, "Input",ExpressionUUID->"5f4d786d-ae84-42f8-86f5-3a6c133fd78b"],
Cell[13869, 349, 156, 3, 31, "Input",ExpressionUUID->"a6b2643c-fbfd-444a-96da-c903e107fe5e"]
}, Open  ]]
}
]
*)

